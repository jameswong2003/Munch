@page "/login"
@inject IJSRuntime JS
@inject NavigationManager NavigationManager
@inject UserService UserService 

<h3>Log In</h3>

<div>
    <input @bind="email" placeholder="Email" />
    <input type="password" @bind="password" placeholder="Password" />
    <button @onclick="LogIn">Log In</button>
    @if (!string.IsNullOrEmpty(message))
    {
        <div class="alert alert-info">@message</div>
    }
</div>

@code {
    private string email;
    private string password;
    private string message;
    private bool isLoggedIn = false;

    private async Task LogIn()
    {
        try
        {
            var result = await JS.InvokeAsync<AuthResponse>("firebaseAuth.logIn", email, password);
            
            if (result != null && result.Success == true)
            {
                message = "Login successful. Welcome!";
                UserService.Login(email);
                StateHasChanged();
                isLoggedIn = true; 

                NavigationManager.NavigateTo("/");
            }
            else
            {
                message = result?.Error ?? "Login failed. Please try again.";
            }
        }
        catch (JSException ex)
        {
            message = $"JavaScript error during login: {ex.Message}";
        }
        catch (Exception ex)
        {
            message = $"Unexpected error: {ex.Message}";
        }
    }

    private class AuthResponse
    {
        public bool? Success { get; set; }
        public string Error { get; set; }
    }
}
